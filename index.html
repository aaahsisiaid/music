<html lang="ja"><head>
  <meta charset="utf-8">
  <title>YouTube検索＋自動再生</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; padding:20px; }
    input, button { padding:8px; margin:5px; border-radius:6px; border:0; }
    #player { width:100%; max-width:800px; height:450px; margin-top:20px; background:#000; }
    ul { list-style:none; padding:0; }
    li { margin:5px 0; cursor:pointer; color:#0af; }
  </style>
</head>
<body style="--devsite-js-header-height: 0px;">
  <h2>YouTube検索して再生</h2>
  <input type="text" id="query" placeholder="検索キーワード" size="40">
  <button onclick="searchYouTube()">検索</button>
  <ul id="results"></ul>
  <div id="player"></div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const API_KEY = "AIzaSyCtUAPx02UxgEQtJzYcbRA1rJd5vi5AjaM"; // ← 自分のAPIキーに置き換え！
    let player;
    let playlist = [];
    let idx = 0;

    // IFrame API 初期化
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '450',
        width: '800',
        videoId: '',
        events: {
          'onStateChange': onPlayerStateChange
        }
      });
    }

    // 再生終了で次へ
    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        idx = (idx + 1) % playlist.length;
        player.loadVideoById(playlist[idx]);
      }
    }

    // 検索処理
    async function searchYouTube() {
      const q = document.getElementById('query').value;
      if (!q) return;
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(q)}&key=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      console.log(data);

      playlist = data.items.map(item => item.id.videoId);
      idx = 0;
      showResults(data.items);
      if (playlist.length > 0) {
        player.loadVideoById(playlist[0]);
      }
    }

    // 検索結果を表示
    function showResults(items) {
      const ul = document.getElementById('results');
      ul.innerHTML = '';
      items.forEach((item, i) => {
        const li = document.createElement('li');
        li.textContent = `${item.snippet.title}`;
        li.onclick = () => {
          idx = i;
          player.loadVideoById(playlist[idx]);
        };
        ul.appendChild(li);
      });
    }
  </script>


</body></html>
